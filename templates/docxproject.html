{% extends "base.html" %}

{% block head %}
    <link href="//cdn.quilljs.com/1.3.7/quill.snow.css" rel="stylesheet">
    <script src="//cdn.quilljs.com/1.3.7/quill.min.js"></script>
    <script src="{{ url_for('static', filename='js/caret.js') }}" type="application/javascript"></script>
    <script src="{{ url_for('static', filename='js/controlInput.js') }}" type="application/javascript"></script>
{% endblock %}
{% block content %}
<form action="/project/{{id}}" method="POST">
<div class="columns is-multiline is-mobile lastelement">
    <div class="column is-half">
        <div class="control">
            <h2 class="title is-4">Texte Original</h2>
        </div>
    </div>
    <div class="column is-half">
        <div class="control">
            <h2 class="title is-4">Texte Traduit</h2>
        </div>
    </div>
    <div class="column is-half">
        <div class="control">
            <label class="label">Segment Précédent</label>
            <textarea class="textarea has-fixed-size" placeholder="Fixed size textarea" rows="5"></textarea>
        </div>
    </div>
    <div class="column is-half">
        <div class="control">
            <label class="label">Segment Précédent</label>
            <textarea class="textarea has-fixed-size" placeholder="Fixed size textarea" rows="5"></textarea>
        </div>
    </div>
    <div class="column is-half">
        <div class="control">
            <label class="label">Segment Actuel</label>
            <div id="disablededitorjs" {% if complete %}oninput="autocompletescript(event)" onkeypress="clear(event)" {% endif %} ></div>
        </div>
    </div>
    <div class="column is-half">
        <div class="control">
            <label class="label">Segment Actuel</label>
            <div id="editorjs" {% if complete %}oninput="autocompletescript(event)" onkeypress="clear(event)"  {% endif %}></div>
        </div>
    </div>
    <div class="column is-half">
        <div class="control">
            <label class="label">Segment Suivant</label>
            <textarea class="textarea has-fixed-size" placeholder="Fixed size textarea" rows="5"></textarea>
        </div>
    </div>
    <div class="column is-half">
        <div class="control">
            <label class="label">Segment Suivant</label>
            <textarea class="textarea has-fixed-size" placeholder="Fixed size textarea" rows="5"></textarea>
        </div>
    </div>
    <div class="control as-centered sectionpage">
        <a class="button" onclick="downsectionnumber()"><</a>
        <input class="input" id="sectionnumber" type="text" autocomplete="off" value="{{ last }}" oninput="parseInt(getRessourceProject(document.getElementById('sectionnumber').value))">
        <a class="button" onclick="upsectionnumber()">></a>
    </div>
</div>
</form>

<script src="{{ url_for('static', filename='js/inputFilter.js') }}" type="application/javascript"></script>
<script src="{{ url_for('static', filename='js/createEditor.js') }}" type="application/javascript"></script>
{% if complete %}<script src="{{ url_for('static', filename='js/autocomplete.js') }}" type="application/javascript"></script>{% endif %}
<script>
var previousidblock = null
function getRessourceProject(block){
    var url = "/project/{{id}}";
    var ressourcerequest = new XMLHttpRequest();
    ressourcerequest.open("POST", url, true);
    ressourcerequest.setRequestHeader("Content-Type", "application/json");
    var translatedrequest = new XMLHttpRequest();
    translatedrequest.open("POST", url, true);
    translatedrequest.setRequestHeader("Content-Type", "application/json");
        translatedrequest.onreadystatechange = function ()
    {
        if (translatedrequest.readyState === 4 && translatedrequest.status === 200)
        {
            previousidblock = block
            var json = JSON.parse(translatedrequest.responseText);
            var htmlblock = json.result;
            document.getElementsByClassName("ql-editor")[1].innerHTML = htmlblock
            {% if keepstyle %}
            document.getElementsByClassName("ql-editor")[1].children[0].className = document.getElementsByClassName("ql-editor")[0].children[0].className //ligne pour keepstyle sur la page paramètres
            {% endif %}

        }
    };
    ressourcerequest.onreadystatechange = function ()
    {
        if (ressourcerequest.readyState === 4 && ressourcerequest.status === 200)
        {
            var json = JSON.parse(ressourcerequest.responseText);
            var htmlblock = json.result;
            document.getElementsByClassName("ql-editor")[0].innerHTML = htmlblock
            var transtateddata = JSON.stringify({"translated": block , "previoustranslated": previousidblock,  "originaltext" : document.getElementsByClassName("ql-editor")[0].innerHTML, "translatedtext" : document.getElementsByClassName("ql-editor")[1].innerHTML });
            translatedrequest.send(transtateddata);
        }
    };
    var resourcedata = JSON.stringify({"ressource": block});
    ressourcerequest.send(resourcedata);
    {% if keepstyle %}
    document.getElementsByClassName("ql-editor")[1].children[0].className = document.getElementsByClassName("ql-editor")[0].children[0].className //ligne pour keepstyle sur la page paramètres
    {% endif %}
    {% if complete %}
    htmltoshow.textContent = ""
    {% endif %}
    }
</script>
<script>
    document.getElementById("sectionnumber").value = {{ last }}
    getRessourceProject(document.getElementById('sectionnumber').value);
</script>
{% endblock %}